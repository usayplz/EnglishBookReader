<html>
<head>
    <script src='file:///android_asset/html/jquery.min.js'></script>
    <style type="text/css">
        @font-face { font-family: Chivo-Regular; src: url('file:///android_asset/fonts/Chivo-Regular.ttf');}
        @font-face { font-family: OpenSans-Regular; src: url('file:///android_asset/fonts/OpenSans-Regular.ttf');}
        @font-face { font-family: Roboto-Mono-Regular; src: url('file:///android_asset/fonts/Roboto-Mono-Regular.ttf');}

        body {
            margin: 0;
            padding: 0;
        }

        img {
            max-width: 100% !important;
            max-height: 100% !important;
        }

        #container {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: white;
        }

        #content {
            position: relative;
            margin: 32px 32px 0px 32px;

            -moz-column-gap: 64px;
            -webkit-column-gap: 64px;
            column-gap: 64px;

            font-size: 18px !important;
        }

        #bottom {
            text-align: center;
        }

        .page {
            display: inline-block;
            color: #999999;
            margin: 5px 0px 5px 0px;
            font-size: 16px;
        }
    </style>
</head>

<body>
    <div id="container">
        <div id="content">
            ${content}
            <span id="end_marker"></span>
        </div>
        <div id="bottom">
            <span id="page" class="page"></span>
        </div>
    </div>

    <script type="text/javascript">
    	function setPage(i) {
			column = i;
        	document.getElementById('content').style.left = -1 * (column - 1) * (columnWidth + columnGap);
        	document.getElementById('page').textContent = column + " / " + columnCount;
        }

        var column = 1;
    	var columnWidth = document.getElementById('content').offsetWidth;

        document.getElementById('content').style.height = window.innerHeight - 64 + 'px';
    	document.getElementById('content').style.columnWidth = columnWidth + "px";
        document.getElementById('content').style.MozColumnWidth = columnWidth + "px";
        document.getElementById('content').style.WebkitColumnWidth = columnWidth + "px";

		var columnGap = 64;
		var columnCount = Math.ceil($('#end_marker').offset().left / (columnWidth + columnGap));
        var currentColumn;

        currentColumn = 1;

		setPage(currentColumn);
		android.getPageCount(columnCount);

        // Selection
		function getWordAtPoint(elem, x, y) {
            if(elem.nodeType == elem.TEXT_NODE) {
                var range = elem.ownerDocument.createRange();
                range.selectNodeContents(elem);

                var currentPos = 0;
                var endPos = range.endOffset;
                while(currentPos+1 < endPos) {
                    range.setStart(elem, currentPos);
                    range.setEnd(elem, currentPos+1);
                    if (range.getBoundingClientRect() == null) return null;
                    if (range.getBoundingClientRect().left <= x && range.getBoundingClientRect().right  >= x && range.getBoundingClientRect().top  <= y && range.getBoundingClientRect().bottom >= y) {
                        range.expand("word");
                        this.lastNode = elem;
                        this.lastRange = range;
                        var ret = range.toString();
                        range.detach();
                        var text = elem.parentElement.textContent;
                        return ret;
                    }

                    currentPos += 1;
                }
            } else {
                for(var i = 0; i < elem.childNodes.length; i++) {
                    var range = elem.childNodes[i].ownerDocument.createRange();
                    range.selectNodeContents(elem.childNodes[i]);
                    if(range.getBoundingClientRect().left <= x && range.getBoundingClientRect().right  >= x &&
                        range.getBoundingClientRect().top  <= y && range.getBoundingClientRect().bottom >= y) {
                        range.detach();
                        return getWordAtPoint(elem.childNodes[i], x, y);
                    } else {
                        range.detach();
                    }
                }
            }
            return null;
        }


        function selectWord(e) {
            var x = e.clientX;
            var y = e.clientY;
            var sel = getWordAtPoint(e.srcElement,x,y);
            if (sel) {
                sel = sel.trim();
                alert(sel);
            }
        }

        document.addEventListener("click", selectWord);
    </script>
</body>
</html>